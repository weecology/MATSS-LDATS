Toy full likelihood
================
Renata Diaz
8/6/2019

Full model likelihood
---------------------

Based on Slack & in person conversation with Hao Ye & Juniper Simonis.

Tacking a full likelihood computation on to existing runs of LDA\_TS models, moving towards whole-model evaluation of goodness of fit (instead of evaluting and selecting LDA and TS components separately and sequentially).

Likelihood of observed dataset (observed term frequencies in each document) from LDA and TS model...

``` r
dat1 <- readd(bbs_data_rtrg_1_11, cache = cache)
counts1 <- dat1$abundance
lda1 <- readd(lda_select_lda_bbs_data_rtrg_1_11_5, cache = cache)
ts1 <- readd(ts_bbs_data_rtrg_1_11_lda_select_lda_bbs_data_rtrg_1_11_5, cache = cache)[[4]]

#plot(lda1)

#plot(ts1)
```

``` r
get_relevant_covars <- function(covariates_table, ts_formula) {
    formula_string <- unlist(as.character(ts_formula))
    
    formula_string <- formula_string[ which((formula_string != "~") & (formula_string != "gamma") & (formula_string != "1"))]

    covariates_table$intercept <- 1
    covars <- as.data.frame(covariates_table[ , c("intercept", formula_string)])
    
    return(covars)
}

get_theta <- function(ts_model, sim = 1){

covars <- get_relevant_covars(ts_model$data, ts_model$formula)

ncovar <- ncol(covars)
nseg <- ifelse(is.null(ts_model$rhos), 1, ncol(ts_model$rhos) + 1)
ntopics <- ncol(ts_model$data$gamma)

ndocs <- nrow(ts_model$data)

X <- matrix(nrow = ndocs, ncol = ncovar, data = unlist(covars), byrow = FALSE)

model_Eta <- ts_model$etas[sim, ]

Eta_matrix <- matrix(nrow = ncovar  * nseg, ncol = ntopics,
                     data = c(rep(0, times = ncovar * nseg), model_Eta), byrow = FALSE)

rho = ts_model$rhos[sim,]

tD <- unlist(ts_model$data[ , ts_model$timename])

Theta <- sim_TS_data(X, Eta_matrix, rho, tD, err = 0)

return(Theta) 
}


get_doc_lik <- function(counts_matrix, p_matrix, index) {
    counts <- as.integer(counts_matrix[index, ])
    ps <- p_matrix[index, ]
    doc_loglik <- dmultinom(x = counts, prob = ps, log = TRUE)
    return(doc_loglik)
}


get_aicc <- function(beta, theta, lda_model, ts_model) {
    P1exp <- theta %*% beta1exp

doc_lik1 <- vapply(1:nrow(counts1), FUN = get_doc_lik, counts_matrix = counts1, 
                   p_matrix = P1exp, FUN.VALUE = -1)

ldapars <- attr(logLik(lda_model[[1]]), "df")
tspars <- attr(logLik(ts_model), "df")

totalpars <- ldapars + tspars

nobs <- attr(logLik(ts_model), "nobs")

AICc <- (-2 * (sum(doc_lik1))) + 2*(totalpars) + 
    (2 * totalpars^2 + 2 * totalpars)/(nobs - totalpars - 1)

return(AICc)
}
```

``` r
beta1 <- lda1$`k: 5, seed: 122`@beta

beta1exp <- exp(beta1)
```

``` r
all_thetas <- lapply(X = c(1:nrow(ts1$etas)), FUN = get_theta, ts_model = ts1)
```

``` r
all_aicc <- vapply(X = all_thetas, FUN = get_aicc, beta = beta1exp, lda_model = lda1, ts_model = ts1, FUN.VALUE = 100.1)
```

``` r
library(ggplot2)

all_aicc <- as.data.frame(all_aicc)

aicc_plot <- ggplot(data = all_aicc, aes(x = all_aicc)) + 
    geom_histogram() +
    theme_bw()

all_aicc
```

    ##      all_aicc
    ## 1    51152.10
    ## 2    58838.09
    ## 3    50562.65
    ## 4    58224.16
    ## 5    63366.54
    ## 6    56903.10
    ## 7    56975.08
    ## 8    71269.13
    ## 9    60284.97
    ## 10   56651.85
    ## 11   79179.79
    ## 12   50043.03
    ## 13   76326.81
    ## 14   54576.42
    ## 15   62177.41
    ## 16   68904.36
    ## 17   61409.35
    ## 18   49538.33
    ## 19   54949.52
    ## 20   63282.30
    ## 21   57501.30
    ## 22   57974.84
    ## 23   53207.39
    ## 24   58414.06
    ## 25   63858.27
    ## 26   58383.89
    ## 27   60167.88
    ## 28   51612.68
    ## 29   67988.22
    ## 30   53134.23
    ## 31   60557.27
    ## 32   59040.19
    ## 33   54888.35
    ## 34   55465.32
    ## 35   52459.59
    ## 36   56825.59
    ## 37   54378.74
    ## 38   66176.62
    ## 39   63779.19
    ## 40   45315.55
    ## 41   51083.12
    ## 42   58325.21
    ## 43   56786.42
    ## 44   63848.10
    ## 45   54790.60
    ## 46   60476.42
    ## 47   59597.64
    ## 48   57171.51
    ## 49   53127.80
    ## 50   56732.64
    ## 51   71202.96
    ## 52   54462.96
    ## 53   54882.56
    ## 54   64787.97
    ## 55   64334.63
    ## 56   50711.70
    ## 57   59024.71
    ## 58   51776.91
    ## 59   52865.31
    ## 60   75872.57
    ## 61   50966.41
    ## 62   62422.42
    ## 63   61090.92
    ## 64   49712.68
    ## 65   54585.81
    ## 66   49998.03
    ## 67   53775.22
    ## 68   64560.09
    ## 69   50418.61
    ## 70   59537.32
    ## 71   49767.99
    ## 72   63197.30
    ## 73   58422.22
    ## 74   57341.84
    ## 75   64004.54
    ## 76   51062.88
    ## 77   67252.39
    ## 78   58950.98
    ## 79   54653.00
    ## 80   54634.26
    ## 81   58481.98
    ## 82   52363.75
    ## 83   58037.52
    ## 84   51835.11
    ## 85   58296.64
    ## 86   76422.89
    ## 87   54593.58
    ## 88   57890.74
    ## 89   60265.04
    ## 90   56788.71
    ## 91   61620.41
    ## 92   64417.32
    ## 93   60651.90
    ## 94   52790.18
    ## 95   55282.63
    ## 96   55886.20
    ## 97   59862.43
    ## 98   56127.55
    ## 99   47289.75
    ## 100  55821.03
    ## 101  57259.53
    ## 102  51176.10
    ## 103  58053.61
    ## 104  65504.40
    ## 105  57633.10
    ## 106  49793.27
    ## 107  48099.11
    ## 108  45283.44
    ## 109  49459.46
    ## 110  53135.94
    ## 111  63712.74
    ## 112  59499.67
    ## 113  73528.20
    ## 114  48328.63
    ## 115  55346.49
    ## 116  54465.89
    ## 117  60510.73
    ## 118  57912.42
    ## 119  50613.87
    ## 120  57287.09
    ## 121  56376.16
    ## 122  59837.67
    ## 123  64687.83
    ## 124  57463.94
    ## 125  66230.89
    ## 126  53090.50
    ## 127  60633.78
    ## 128  47510.70
    ## 129  49085.15
    ## 130  53758.74
    ## 131  56347.13
    ## 132  57894.64
    ## 133  54794.61
    ## 134  61449.79
    ## 135  58072.44
    ## 136  62496.42
    ## 137  65621.10
    ## 138  55390.48
    ## 139  59808.00
    ## 140  57638.72
    ## 141  56725.39
    ## 142  65158.11
    ## 143  57944.82
    ## 144  59612.26
    ## 145  52393.97
    ## 146  55424.80
    ## 147  54050.89
    ## 148  54906.30
    ## 149  64583.16
    ## 150  62037.63
    ## 151  58601.29
    ## 152  48056.24
    ## 153  54294.31
    ## 154  63766.91
    ## 155  53811.71
    ## 156  65285.13
    ## 157  60398.39
    ## 158  69243.20
    ## 159  51368.22
    ## 160  54716.84
    ## 161  62454.61
    ## 162  46868.23
    ## 163  52985.69
    ## 164  65640.59
    ## 165  56442.77
    ## 166  47750.02
    ## 167  53511.25
    ## 168  55003.94
    ## 169  62045.75
    ## 170  56343.42
    ## 171  52188.40
    ## 172  55154.07
    ## 173  55180.56
    ## 174  56356.79
    ## 175  56742.50
    ## 176  58673.67
    ## 177  55830.01
    ## 178  55801.32
    ## 179  50963.29
    ## 180  56211.12
    ## 181  59156.74
    ## 182  61253.63
    ## 183  53516.58
    ## 184  51470.47
    ## 185  51377.20
    ## 186  57336.67
    ## 187  52653.39
    ## 188  59833.40
    ## 189  59332.86
    ## 190  67257.43
    ## 191  60275.43
    ## 192  61052.72
    ## 193  53971.52
    ## 194  51956.71
    ## 195  60789.81
    ## 196  52222.90
    ## 197  56533.88
    ## 198  58182.69
    ## 199  61893.67
    ## 200  52131.35
    ## 201  69465.36
    ## 202  63578.22
    ## 203  64783.81
    ## 204  63903.59
    ## 205  58767.19
    ## 206  56708.78
    ## 207  54215.53
    ## 208  55774.15
    ## 209  52267.39
    ## 210  49589.61
    ## 211  61034.68
    ## 212  71277.93
    ## 213  53383.17
    ## 214  66400.22
    ## 215  51089.66
    ## 216  57614.60
    ## 217  59438.58
    ## 218  57783.09
    ## 219  69859.06
    ## 220  54402.01
    ## 221  56490.74
    ## 222  59024.51
    ## 223  55244.93
    ## 224  53873.80
    ## 225  59986.45
    ## 226  67991.52
    ## 227  70928.71
    ## 228  63645.75
    ## 229  50186.33
    ## 230  61305.06
    ## 231  63859.11
    ## 232  60795.06
    ## 233  55512.02
    ## 234  54272.02
    ## 235  64302.81
    ## 236  60595.44
    ## 237  71302.34
    ## 238  58584.52
    ## 239  66859.89
    ## 240  58052.20
    ## 241  57991.89
    ## 242  61729.03
    ## 243  61349.49
    ## 244  57744.24
    ## 245  54970.22
    ## 246  63960.67
    ## 247  57718.39
    ## 248  60421.29
    ## 249  56726.55
    ## 250  59121.83
    ## 251  59722.42
    ## 252  59031.87
    ## 253  66853.51
    ## 254  56496.52
    ## 255  55753.00
    ## 256  53995.37
    ## 257  53404.37
    ## 258  54242.12
    ## 259  54474.62
    ## 260  61543.23
    ## 261  56581.19
    ## 262  70938.67
    ## 263  55734.26
    ## 264  58513.65
    ## 265  67886.33
    ## 266  74808.98
    ## 267  62102.74
    ## 268  56596.00
    ## 269  54271.41
    ## 270  70408.16
    ## 271  47302.08
    ## 272  61727.36
    ## 273  64710.82
    ## 274  54109.64
    ## 275  63654.30
    ## 276  56897.96
    ## 277  55687.51
    ## 278  68681.33
    ## 279  59198.54
    ## 280  52025.37
    ## 281  57851.10
    ## 282  59300.44
    ## 283  58211.54
    ## 284  60244.72
    ## 285  51458.51
    ## 286  52896.37
    ## 287  61262.47
    ## 288  51546.32
    ## 289  69333.25
    ## 290  53998.53
    ## 291  59988.73
    ## 292  53817.79
    ## 293  49142.46
    ## 294  58898.04
    ## 295  61382.52
    ## 296  68031.03
    ## 297  50342.94
    ## 298  66704.05
    ## 299  57163.86
    ## 300  48919.32
    ## 301  50888.23
    ## 302  56795.98
    ## 303  47921.47
    ## 304  50430.16
    ## 305  50604.30
    ## 306  73880.94
    ## 307  59329.06
    ## 308  63199.24
    ## 309  50966.97
    ## 310  51582.92
    ## 311  65532.33
    ## 312  59894.52
    ## 313  53922.89
    ## 314  61963.12
    ## 315  46520.53
    ## 316  74474.16
    ## 317  48523.84
    ## 318  56459.20
    ## 319  66202.72
    ## 320  82710.68
    ## 321  52094.71
    ## 322  51850.00
    ## 323  70115.40
    ## 324  58826.99
    ## 325  54861.03
    ## 326  59672.54
    ## 327  57662.55
    ## 328  54682.83
    ## 329  62480.28
    ## 330  55466.70
    ## 331  55296.38
    ## 332  59055.94
    ## 333  53843.81
    ## 334  60595.13
    ## 335  54698.97
    ## 336  62974.95
    ## 337  56395.19
    ## 338  47774.92
    ## 339  56176.09
    ## 340  66460.12
    ## 341  44461.89
    ## 342  55319.89
    ## 343  57386.76
    ## 344  56597.56
    ## 345  54618.48
    ## 346  59030.03
    ## 347  58170.20
    ## 348  57813.63
    ## 349  57909.32
    ## 350  51045.15
    ## 351  57846.65
    ## 352  62423.51
    ## 353  54652.79
    ## 354  52046.52
    ## 355  70771.87
    ## 356  69775.64
    ## 357  53961.77
    ## 358  68168.06
    ## 359  58988.79
    ## 360  66017.86
    ## 361  60383.07
    ## 362  60689.42
    ## 363  55617.70
    ## 364  61926.82
    ## 365  48764.89
    ## 366  66192.28
    ## 367  64311.03
    ## 368  55538.55
    ## 369  53079.78
    ## 370  59318.68
    ## 371  59869.92
    ## 372  46610.70
    ## 373  45708.02
    ## 374  74945.90
    ## 375  54616.91
    ## 376  62811.64
    ## 377  52256.40
    ## 378  58562.09
    ## 379  55855.75
    ## 380  49871.51
    ## 381  59383.82
    ## 382  58098.73
    ## 383  55448.84
    ## 384  55030.31
    ## 385  55538.80
    ## 386  56807.85
    ## 387  63409.51
    ## 388  51949.99
    ## 389  56311.80
    ## 390  65523.95
    ## 391  59844.94
    ## 392  53520.11
    ## 393  63298.25
    ## 394  59843.06
    ## 395  60017.35
    ## 396  54314.35
    ## 397  53024.75
    ## 398  42750.04
    ## 399  60916.95
    ## 400  52032.39
    ## 401  58642.14
    ## 402  65908.29
    ## 403  46467.37
    ## 404  67223.52
    ## 405  55742.76
    ## 406  53628.33
    ## 407  51046.24
    ## 408  57082.02
    ## 409  58047.02
    ## 410  61425.65
    ## 411  62986.44
    ## 412  63464.80
    ## 413  55072.36
    ## 414  59491.26
    ## 415  55811.96
    ## 416  52100.77
    ## 417  57427.47
    ## 418  57562.55
    ## 419  54928.53
    ## 420  55530.09
    ## 421  44829.36
    ## 422  54310.15
    ## 423  56755.55
    ## 424  60358.56
    ## 425  50105.62
    ## 426  52023.22
    ## 427  63097.88
    ## 428  53109.49
    ## 429  61844.94
    ## 430  61457.48
    ## 431  54738.98
    ## 432  55400.69
    ## 433  54882.76
    ## 434  79601.86
    ## 435  58887.71
    ## 436  58151.89
    ## 437  56999.88
    ## 438  55646.66
    ## 439  56195.75
    ## 440  53744.50
    ## 441  49733.46
    ## 442  55442.43
    ## 443  56930.63
    ## 444  66483.71
    ## 445  64640.63
    ## 446  56784.82
    ## 447  55880.13
    ## 448  64228.96
    ## 449  55791.79
    ## 450  57047.52
    ## 451  58031.63
    ## 452  56756.46
    ## 453  56162.03
    ## 454  70590.89
    ## 455  58495.08
    ## 456  57790.57
    ## 457  64325.12
    ## 458  56509.41
    ## 459  62920.55
    ## 460  57856.76
    ## 461  56357.41
    ## 462  48132.34
    ## 463  55136.69
    ## 464  57389.11
    ## 465  53536.34
    ## 466  60774.38
    ## 467  63791.27
    ## 468  58728.18
    ## 469  55376.70
    ## 470  50668.57
    ## 471  54399.67
    ## 472  57460.97
    ## 473  61003.42
    ## 474  55006.89
    ## 475  58592.82
    ## 476  58417.67
    ## 477  67879.31
    ## 478  58227.89
    ## 479  52795.64
    ## 480  50698.15
    ## 481  57750.99
    ## 482  51249.42
    ## 483  56655.68
    ## 484  54178.88
    ## 485  57817.95
    ## 486  53667.16
    ## 487  53506.77
    ## 488  59630.38
    ## 489  45947.91
    ## 490  59449.34
    ## 491  47871.08
    ## 492  64775.59
    ## 493  49293.52
    ## 494  66915.35
    ## 495  60146.74
    ## 496  51118.31
    ## 497  48765.84
    ## 498  50415.62
    ## 499  58872.02
    ## 500  73467.89
    ## 501  54755.64
    ## 502  60687.05
    ## 503  65638.64
    ## 504  54261.76
    ## 505  52899.58
    ## 506  62262.98
    ## 507  57310.73
    ## 508  60455.86
    ## 509  49006.51
    ## 510  58528.12
    ## 511  58876.50
    ## 512  61164.32
    ## 513  60268.91
    ## 514  70023.55
    ## 515  69808.20
    ## 516  57326.23
    ## 517  55042.30
    ## 518  50247.92
    ## 519  67488.03
    ## 520  55089.42
    ## 521  55187.26
    ## 522  59805.91
    ## 523  62629.98
    ## 524  55446.80
    ## 525  63654.37
    ## 526  63552.76
    ## 527  66983.40
    ## 528  72663.97
    ## 529  58490.26
    ## 530  49758.62
    ## 531  59192.32
    ## 532  62965.91
    ## 533  71679.05
    ## 534  56857.27
    ## 535  58550.55
    ## 536  58503.40
    ## 537  71449.17
    ## 538  63462.64
    ## 539  60978.85
    ## 540  61230.41
    ## 541  58260.41
    ## 542  56378.16
    ## 543  60196.36
    ## 544  57681.73
    ## 545  58650.40
    ## 546  59375.74
    ## 547  55203.56
    ## 548  45244.20
    ## 549  54480.44
    ## 550  51396.85
    ## 551  61446.41
    ## 552  66135.76
    ## 553  50470.73
    ## 554  49919.04
    ## 555  54396.94
    ## 556  54702.06
    ## 557  60257.83
    ## 558  51505.58
    ## 559  48473.61
    ## 560  58877.25
    ## 561  61315.62
    ## 562  58553.65
    ## 563  50642.21
    ## 564  60342.20
    ## 565  62450.34
    ## 566  57403.76
    ## 567  63605.95
    ## 568  61363.83
    ## 569  60040.65
    ## 570  53618.43
    ## 571  57540.63
    ## 572  57470.34
    ## 573  44697.98
    ## 574  56817.89
    ## 575  55396.63
    ## 576  50075.38
    ## 577  56478.63
    ## 578  49349.83
    ## 579  60107.35
    ## 580  57001.12
    ## 581  53509.48
    ## 582  56209.48
    ## 583  51325.17
    ## 584  55705.74
    ## 585  56753.17
    ## 586  60966.42
    ## 587  52320.26
    ## 588  63488.50
    ## 589  68839.48
    ## 590  61256.41
    ## 591  54486.19
    ## 592  53676.52
    ## 593  58195.96
    ## 594  61290.82
    ## 595  53547.64
    ## 596  49566.19
    ## 597  58626.99
    ## 598  57802.63
    ## 599  67704.85
    ## 600  56848.94
    ## 601  49639.68
    ## 602  51833.88
    ## 603  55782.37
    ## 604  56615.33
    ## 605  56814.40
    ## 606  46185.99
    ## 607  62479.99
    ## 608  61484.56
    ## 609  50618.96
    ## 610  53600.88
    ## 611  49775.94
    ## 612  55350.75
    ## 613  64703.81
    ## 614  63850.03
    ## 615  53546.80
    ## 616  59100.36
    ## 617  51804.25
    ## 618  67367.20
    ## 619  60291.04
    ## 620  58147.87
    ## 621  52552.56
    ## 622  57007.91
    ## 623  53680.10
    ## 624  57038.02
    ## 625  61696.63
    ## 626  70573.56
    ## 627  67611.38
    ## 628  80526.76
    ## 629  62510.48
    ## 630  52047.50
    ## 631  62657.35
    ## 632  60993.33
    ## 633  51525.17
    ## 634  65001.18
    ## 635  68520.57
    ## 636  54126.94
    ## 637  65620.83
    ## 638  61674.08
    ## 639  61752.27
    ## 640  64456.94
    ## 641  57563.43
    ## 642  57678.94
    ## 643  57823.51
    ## 644  59653.83
    ## 645  57558.82
    ## 646  59677.94
    ## 647  52427.78
    ## 648  55837.37
    ## 649  57625.28
    ## 650  59748.70
    ## 651  57010.35
    ## 652  48284.78
    ## 653  54135.12
    ## 654  55346.18
    ## 655  54482.19
    ## 656  61141.46
    ## 657  61210.58
    ## 658  62697.84
    ## 659  64727.87
    ## 660  58826.34
    ## 661  52679.37
    ## 662  57054.90
    ## 663  63267.47
    ## 664  57722.44
    ## 665  63543.96
    ## 666  59470.54
    ## 667  58644.82
    ## 668  51603.92
    ## 669  58825.59
    ## 670  60637.03
    ## 671  55430.98
    ## 672  54912.62
    ## 673  64814.71
    ## 674  61021.64
    ## 675  63756.97
    ## 676  65972.68
    ## 677  56666.47
    ## 678  47908.75
    ## 679  55853.66
    ## 680  68423.34
    ## 681  70006.38
    ## 682  49593.51
    ## 683  54826.95
    ## 684  57039.31
    ## 685  56846.66
    ## 686  56804.88
    ## 687  62890.20
    ## 688  45496.10
    ## 689  52329.56
    ## 690  56755.69
    ## 691  51819.36
    ## 692  54484.00
    ## 693  54305.04
    ## 694  61941.36
    ## 695  70576.89
    ## 696  70175.47
    ## 697  53585.51
    ## 698  49255.86
    ## 699  62844.37
    ## 700  57973.05
    ## 701  67131.87
    ## 702  54582.52
    ## 703  43112.18
    ## 704  60814.09
    ## 705  56369.19
    ## 706  51659.04
    ## 707  65002.08
    ## 708  63933.17
    ## 709  50666.74
    ## 710  62122.93
    ## 711  65332.28
    ## 712  49129.69
    ## 713  61114.98
    ## 714  62549.63
    ## 715  68236.04
    ## 716  49317.90
    ## 717  58100.24
    ## 718  56660.53
    ## 719  55185.06
    ## 720  57982.69
    ## 721  54257.45
    ## 722  55608.27
    ## 723  60858.41
    ## 724  53270.58
    ## 725  58559.48
    ## 726  58194.26
    ## 727  53128.86
    ## 728  56860.63
    ## 729  56780.35
    ## 730  57353.71
    ## 731  56866.95
    ## 732  58776.30
    ## 733  53884.85
    ## 734  51782.80
    ## 735  58249.64
    ## 736  53602.97
    ## 737  55372.49
    ## 738  53975.03
    ## 739  53245.20
    ## 740  52929.05
    ## 741  54984.31
    ## 742  55188.72
    ## 743  60478.14
    ## 744  60946.29
    ## 745  63948.90
    ## 746  58936.76
    ## 747  56546.73
    ## 748  52906.91
    ## 749  52080.06
    ## 750  55436.62
    ## 751  54156.02
    ## 752  61505.79
    ## 753  68362.26
    ## 754  52207.67
    ## 755  59495.71
    ## 756  51983.70
    ## 757  63211.87
    ## 758  57030.96
    ## 759  57378.49
    ## 760  52972.51
    ## 761  63306.99
    ## 762  61756.15
    ## 763  58477.66
    ## 764  54308.16
    ## 765  64521.68
    ## 766  56650.21
    ## 767  55259.96
    ## 768  54513.26
    ## 769  55972.46
    ## 770  55256.27
    ## 771  66114.88
    ## 772  59276.14
    ## 773  57609.37
    ## 774  53237.31
    ## 775  59115.86
    ## 776  53467.50
    ## 777  66171.67
    ## 778  51033.92
    ## 779  59770.07
    ## 780  60597.86
    ## 781  55403.02
    ## 782  53583.75
    ## 783  58487.33
    ## 784  59784.72
    ## 785  53106.99
    ## 786  57423.37
    ## 787  57547.98
    ## 788  54676.25
    ## 789  68724.24
    ## 790  67136.46
    ## 791  74889.69
    ## 792  56810.34
    ## 793  57813.66
    ## 794  54770.27
    ## 795  56652.43
    ## 796  62490.93
    ## 797  70907.93
    ## 798  48616.40
    ## 799  61004.26
    ## 800  58269.49
    ## 801  58489.26
    ## 802  55674.01
    ## 803  57207.18
    ## 804  51247.75
    ## 805  57814.31
    ## 806  66907.53
    ## 807  51434.86
    ## 808  54899.28
    ## 809  52884.93
    ## 810  54977.13
    ## 811  59899.30
    ## 812  60577.72
    ## 813  55287.52
    ## 814  56944.21
    ## 815  66255.11
    ## 816  51673.59
    ## 817  59516.89
    ## 818  58978.13
    ## 819  58908.93
    ## 820  49383.34
    ## 821  44952.44
    ## 822  65121.41
    ## 823  59216.48
    ## 824  66379.09
    ## 825  56615.45
    ## 826  49901.85
    ## 827  50956.08
    ## 828  55066.86
    ## 829  61241.70
    ## 830  60515.92
    ## 831  62767.11
    ## 832  62110.41
    ## 833  56779.13
    ## 834  56602.22
    ## 835  57245.59
    ## 836  74998.95
    ## 837  61075.31
    ## 838  50690.71
    ## 839  62042.13
    ## 840  63214.75
    ## 841  58280.78
    ## 842  71024.87
    ## 843  55016.46
    ## 844  52164.01
    ## 845  52486.18
    ## 846  52674.71
    ## 847  49484.88
    ## 848  55568.49
    ## 849  48773.08
    ## 850  60361.86
    ## 851  57505.64
    ## 852  62060.63
    ## 853  55901.42
    ## 854  55739.51
    ## 855  54260.45
    ## 856  56792.50
    ## 857  57743.69
    ## 858  49147.33
    ## 859  55896.81
    ## 860  59469.13
    ## 861  56127.23
    ## 862  65014.58
    ## 863  63514.56
    ## 864  58860.52
    ## 865  54324.73
    ## 866  56700.89
    ## 867  58233.39
    ## 868  50994.28
    ## 869  54106.95
    ## 870  62219.26
    ## 871  53963.48
    ## 872  56810.34
    ## 873  53368.40
    ## 874  77199.54
    ## 875  64857.71
    ## 876  60846.05
    ## 877  59848.91
    ## 878  51307.73
    ## 879  53276.51
    ## 880  56991.52
    ## 881  65745.67
    ## 882  65054.36
    ## 883  50765.65
    ## 884  61471.37
    ## 885  53379.98
    ## 886  46761.12
    ## 887  60373.63
    ## 888  61432.80
    ## 889  43962.26
    ## 890  61143.86
    ## 891  61660.77
    ## 892  62148.03
    ## 893  53054.37
    ## 894  59633.73
    ## 895  55170.39
    ## 896  58939.58
    ## 897  52449.20
    ## 898  55120.50
    ## 899  56491.03
    ## 900  56124.88
    ## 901  59674.12
    ## 902  49719.69
    ## 903  59305.70
    ## 904  54012.73
    ## 905  58437.78
    ## 906  49196.26
    ## 907  52697.48
    ## 908  56926.96
    ## 909  61470.37
    ## 910  55786.24
    ## 911  54231.37
    ## 912  70697.06
    ## 913  57260.64
    ## 914  57958.07
    ## 915  57181.13
    ## 916  58072.70
    ## 917  57526.58
    ## 918  58316.65
    ## 919  59661.48
    ## 920  68133.33
    ## 921  55748.14
    ## 922  60625.12
    ## 923  56606.27
    ## 924  56914.02
    ## 925  61499.14
    ## 926  58882.74
    ## 927  59370.57
    ## 928  43416.72
    ## 929  48246.94
    ## 930  58990.35
    ## 931  54386.25
    ## 932  65097.81
    ## 933  61436.32
    ## 934  50137.78
    ## 935  53647.32
    ## 936  53930.64
    ## 937  57951.02
    ## 938  51934.29
    ## 939  55505.87
    ## 940  57943.76
    ## 941  50638.26
    ## 942  62229.15
    ## 943  59277.06
    ## 944  57528.36
    ## 945  60248.18
    ## 946  60741.01
    ## 947  60843.33
    ## 948  62693.00
    ## 949  52687.77
    ## 950  47839.45
    ## 951  55865.81
    ## 952  54958.99
    ## 953  54591.42
    ## 954  55571.22
    ## 955  66746.63
    ## 956  60698.53
    ## 957  60987.18
    ## 958  59190.13
    ## 959  60398.44
    ## 960  48216.85
    ## 961  57401.26
    ## 962  47338.78
    ## 963  64713.12
    ## 964  58668.43
    ## 965  55278.30
    ## 966  57718.36
    ## 967  60592.38
    ## 968  53127.66
    ## 969  53526.63
    ## 970  63616.78
    ## 971  56904.33
    ## 972  61727.66
    ## 973  62821.14
    ## 974  67037.32
    ## 975  61154.53
    ## 976  57986.97
    ## 977  47457.65
    ## 978  52506.55
    ## 979  53425.88
    ## 980  56116.10
    ## 981  49673.73
    ## 982  55569.56
    ## 983  52189.16
    ## 984  65149.59
    ## 985  59247.38
    ## 986  54769.16
    ## 987  56184.56
    ## 988  56393.36
    ## 989  52515.18
    ## 990  57705.95
    ## 991  54259.48
    ## 992  59104.93
    ## 993  49620.17
    ## 994  58952.91
    ## 995  56864.41
    ## 996  64921.47
    ## 997  54725.22
    ## 998  58814.58
    ## 999  56961.57
    ## 1000 57003.32

``` r
ts_all <- readd(ts_bbs_data_rtrg_1_11_lda_select_lda_bbs_data_rtrg_1_11_5, cache = cache)

get_all_aiccs <- function(lda_model, ts_model, dat_list) {
    betaexp <- exp(lda_model[[1]]@beta)
    all_thetas <- all_thetas <- lapply(X = c(1:nrow(ts_model$etas)), FUN = get_theta, ts_model = ts_model)
    all_aicc <- vapply(X = all_thetas, FUN = get_aicc, beta = betaexp, lda_model = lda_model, ts_model = ts_model, FUN.VALUE = 100.1)
    return(all_aicc)
}

all_aicc <- get_all_aiccs(lda1, ts1, dat1)

all_model_aiccs <- lapply(ts_all, FUN = get_all_aiccs, lda_model = lda1, dat_list = dat1)

all_model_aiccs1 <- dplyr::bind_rows(all_model_aiccs) %>%
    tidyr::gather(key = "model", value = "AICc")

all_aicc_plot <- ggplot(data = all_model_aiccs1, aes(x = model, y = AICc, color = model)) + 
    geom_point() +
    theme_bw()

all_aicc_plot
```

![](full_likelihood_files/figure-markdown_github/get%20all%20model%20aiccs-1.png)
