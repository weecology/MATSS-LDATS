---
title: "TS on LDA report"
author: "Renata Diaz"
date: "10/12/2018"
output: github_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(MATSS)
library(drake)
```

## Read in the results

```{r load TS results}
# define where the cache is located
db <- DBI::dbConnect(RSQLite::SQLite(), here::here("drake", "drake-cache.sqlite"))
cache <- storr::storr_dbi("datatable", "keystable", db)

ts_results <- readd(ts_results, cache = cache)

selected_ts_results <- readd(ts_select_results, cache = cache)
```

## Errors
Find TS models that threw errors while running and remove them:
```{r find error ts, echo = F}
ts_errors <- NULL
for (i in seq(ts_results)){
    if(!is.list(ts_results[[i]])) {
        print(names(ts_results)[i])
        print(ts_results[[i]])
        ts_errors <- c(ts_errors, i)
    }
}
ts_results <- ts_results[seq(ts_results)[which(!(seq(ts_results) %in% ts_errors))]]

```

These TS models ran successfully:

```{r successful ts, echo = F}
# Remaining ts models:
print(names(ts_results))
```

Find TS models that threw errors in selection and remove them:
```{r find error ts select, echo = F}
ts_select_errors <- NULL
for (i in seq(selected_ts_results)){
    if(!is.list(selected_ts_results[[i]])) {
        print(names(selected_ts_results)[i])
        print(selected_ts_results[[i]])
        ts_select_errors <- c(ts_select_errors, i)
    }
}
selected_ts_results <- selected_ts_results[seq(selected_ts_results)[which(!(seq(selected_ts_results) %in% ts_select_errors))]]
```

These TS models were selected correctly:

```{r successful ts_select, echo = F}
# Remaining ts models:
print(names(selected_ts_results))
```

## Community-level results

```{r community level summary stats}
# Number of changepoints

for(i in seq(selected_ts_results)) {
    this_ts = selected_ts_results[[i]]
    # Number of changepoints
    print(names(selected_ts_results)[i])
    print('# Changepoints:')
    print(this_ts$nchangepoints)
    
    # Summary of timesteps (newmoon values) for each changepoint
    print('Timesteps for changepoints:')
    print(this_ts$rho_summary)
}

```

## Cross-community results


